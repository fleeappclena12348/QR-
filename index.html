<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QRã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ â€” ãƒ—ãƒ­ç‰ˆ</title>
  <meta name="description" content="å¤šæ©Ÿèƒ½ãªQRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚µã‚¤ãƒˆï¼ˆvCard/Wi-Fi/ãƒ¡ãƒ¼ãƒ«/SMS/ãƒ­ã‚´åŸ‹ã‚è¾¼ã¿/SVGå‡ºåŠ› ç­‰ï¼‰" />
  <style>
    :root{
      --bg:#0b1220; --card:#071226; --accent:#06b6d4; --muted:#9fb2c8; --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, Noto Sans JP, system-ui, -apple-system, "Segoe UI", Roboto, Arial;background:linear-gradient(180deg,var(--bg),#031025);color:#e8f2fb;min-height:100vh;padding:20px}
    .container{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:18px}
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    h1{margin:0;font-size:18px}
    .left{background:var(--card);padding:14px;border-radius:12px}
    .right{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;display:flex;flex-direction:column;align-items:center;gap:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],input[type=password],input[type=number],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px}
    textarea{min-height:72px}
    .row{display:flex;gap:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;background:linear-gradient(90deg,var(--accent),#38bdf8);color:#042129;font-weight:700}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
    .section{margin-bottom:12px;padding:12px;background:var(--glass);border-radius:10px}
    .small{font-size:12px;color:var(--muted)}
    .controls-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .preview-box{width:360px;height:360px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.2);border-radius:10px;padding:10px}
    .meta{font-size:13px;color:var(--muted)}
    .input-inline{display:flex;gap:8px;align-items:center}
    .flex{display:flex;gap:8px}
    .logo-preview{max-width:90px;max-height:60px;object-fit:contain;border-radius:6px}
    footer{grid-column:1/-1;text-align:center;color:var(--muted);font-size:13px;margin-top:8px}
    @media (max-width:980px){.container{grid-template-columns:1fr;}.preview-box{width:260px;height:260px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>QRã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ â€” ãƒ—ãƒ­ç‰ˆ</h1>
        <div class="small">vCard / Wiâ€‘Fi / Email / SMS / ãƒ­ã‚´åŸ‹ã‚è¾¼ã¿ / SVG å‡ºåŠ› / é«˜åº¦ãªãƒ‡ã‚¶ã‚¤ãƒ³</div>
      </div>
      <div class="meta">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â€¢ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯ï¼ˆPNG / SVGï¼‰</div>
    </header><main class="left">
  <div class="section">
    <label for="template">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</label>
    <select id="template">
      <option value="url">URL</option>
      <option value="text">ãƒ†ã‚­ã‚¹ãƒˆ</option>
      <option value="wifi">Wiâ€‘Fi</option>
      <option value="email">ãƒ¡ãƒ¼ãƒ«</option>
      <option value="sms">SMS</option>
      <option value="vcard">vCard</option>
    </select>
  </div>

  <!-- Dynamic inputs container -->
  <div id="templateFields"></div>

  <div class="section">
    <label>ãƒ‡ã‚¶ã‚¤ãƒ³</label>
    <div class="controls-grid">
      <div>
        <label for="fg">å‰æ™¯è‰²</label>
        <input type="color" id="fg" value="#000000">
      </div>
      <div>
        <label for="bg">èƒŒæ™¯è‰²</label>
        <input type="color" id="bg" value="#ffffff">
      </div>
    </div>
    <div style="height:8px"></div>
    <div class="controls-grid">
      <div>
        <label for="size">ã‚µã‚¤ã‚º (px)</label>
        <input type="number" id="size" value="360" min="64" max="2000">
      </div>
      <div>
        <label for="margin">ä½™ç™½ (moduleå˜ä½)</label>
        <input type="number" id="margin" value="10" min="0" max="100">
      </div>
    </div>

    <div style="height:8px"></div>
    <div class="controls-grid">
      <div>
        <label for="ecLevel">èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«</label>
        <select id="ecLevel"><option value="L">L (7%)</option><option value="M" selected>M (15%)</option><option value="Q">Q (25%)</option><option value="H">H (30%)</option></select>
      </div>
      <div>
        <label for="dotStyle">ãƒ‰ãƒƒãƒˆå½¢çŠ¶</label>
        <select id="dotStyle"><option value="square">å››è§’</option><option value="rounded">ä¸¸</option><option value="dots">ãƒ‰ãƒƒãƒˆ</option></select>
      </div>
    </div>

    <div style="height:8px"></div>
    <div class="controls-grid">
      <div>
        <label for="cornerStyle">ã‚³ãƒ¼ãƒŠãƒ¼å½¢çŠ¶</label>
        <select id="cornerStyle"><option value="square">å››è§’ï¼è§’ä¸¸ãªã—</option><option value="rounded">è§’ä¸¸</option></select>
      </div>
      <div>
        <label for="bgTransparent">èƒŒæ™¯é€é</label>
        <select id="bgTransparent"><option value="false">ã‚ªãƒ•</option><option value="true">ã‚ªãƒ³ï¼ˆé€éï¼‰</option></select>
      </div>
    </div>

    <div style="height:8px"></div>
    <div>
      <label for="logoFile">ãƒ­ã‚´ï¼ˆä¸­å¤®ã«åŸ‹ã‚è¾¼ã¿ï¼‰</label>
      <div class="flex" style="align-items:center">
        <input id="logoFile" type="file" accept="image/*">
        <div style="flex:1"></div>
        <img id="logoPreview" class="logo-preview" src="" alt="" style="display:none">
      </div>
      <div class="small">æ¨å¥¨: 300x300px ä»¥ä¸‹, èƒŒæ™¯é€éPNGãŒæœ€é©ã€‚èª¤ã‚Šè¨‚æ­£ãƒ¬ãƒ™ãƒ«ã‚’é«˜ã‚ã«ã—ã¦ãã ã•ã„ï¼ˆQ/Hï¼‰ã€‚</div>
    </div>

  </div>

  <div class="section">
    <label>å‡ºåŠ› / æ“ä½œ</label>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="updateBtn" class="btn">æ›´æ–°</button>
      <button id="downloadPng" class="btn secondary">PNGãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      <button id="downloadSvg" class="btn secondary">SVGãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      <button id="copyDataUrl" class="btn secondary">ãƒ‡ãƒ¼ã‚¿URLã‚’ã‚³ãƒ”ãƒ¼</button>
      <button id="reset" class="btn secondary">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div style="height:8px"></div>
    <div class="small">SVG ã‚’å‡ºåŠ›ã™ã‚‹ã¨æ‹¡å¤§ã—ã¦ã‚‚é®®æ˜ã§ã™ã€‚ãƒ­ã‚´åŸ‹ã‚è¾¼ã¿ã¯ PNG/Canvas ãƒ™ãƒ¼ã‚¹ã®åˆæˆã§æœ€ã‚‚å®‰å®šã—ã¾ã™ã€‚</div>
  </div>

  <div class="section">
    <label>è©³ç´°æƒ…å ±</label>
    <div class="small" id="info">ãƒ¢ãƒ¼ãƒ‰: - | æ–‡å­—æ•°: 0</div>
  </div>

</main>

<aside class="right">
  <div style="font-size:14px;color:var(--muted)">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
  <div id="previewArea" class="preview-box">
    <!-- QR è¡¨ç¤ºå ´æ‰€ -->
    <div id="qrRoot"></div>
  </div>

  <div class="flex" style="width:100%;justify-content:center">
    <button id="zoomOut" class="btn secondary">ğ„‚ ã‚ºãƒ¼ãƒ å°</button>
    <button id="zoomIn" class="btn">ï¼‹ ã‚ºãƒ¼ãƒ å¤§</button>
  </div>

  <div style="width:100%;display:flex;gap:8px;justify-content:center;align-items:center">
    <div class="small">ã‚µã‚¤ã‚ºãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:</div>
    <div id="sizeLabel" class="small">360px</div>
  </div>

</aside>

<footer>ä½œæˆ: ãƒ—ãƒ­ç‰ˆ QR ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ â€¢ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã”åˆ©ç”¨ãã ã•ã„</footer>

  </div>  <!-- ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: qr-code-styling ï¼ˆSVG/PNG/ãƒ­ã‚´åˆæˆãŒå¯èƒ½ï¼‰ -->  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>  <script>
    // DOM references
    const template = document.getElementById('template');
    const templateFields = document.getElementById('templateFields');
    const fg = document.getElementById('fg');
    const bg = document.getElementById('bg');
    const sizeInput = document.getElementById('size');
    const marginInput = document.getElementById('margin');
    const ecLevel = document.getElementById('ecLevel');
    const dotStyle = document.getElementById('dotStyle');
    const cornerStyle = document.getElementById('cornerStyle');
    const bgTransparent = document.getElementById('bgTransparent');
    const logoFile = document.getElementById('logoFile');
    const logoPreview = document.getElementById('logoPreview');
    const updateBtn = document.getElementById('updateBtn');
    const downloadPng = document.getElementById('downloadPng');
    const downloadSvg = document.getElementById('downloadSvg');
    const copyDataUrl = document.getElementById('copyDataUrl');
    const resetBtn = document.getElementById('reset');
    const info = document.getElementById('info');
    const qrRoot = document.getElementById('qrRoot');
    const sizeLabel = document.getElementById('sizeLabel');
    const zoomIn = document.getElementById('zoomIn');
    const zoomOut = document.getElementById('zoomOut');

    // helper: create input markup per template
    const templates = {
      url: () => `
        <div class="section">
          <label>URL</label>
          <input id="fld_url" type="text" placeholder="https://example.com" value="https://">
        </div>`,
      text: () => `
        <div class="section">
          <label>ãƒ†ã‚­ã‚¹ãƒˆ</label>
          <textarea id="fld_text" placeholder="è‡ªç”±ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›"></textarea></div>`,
  wifi: () => `
    <div class="section">
      <label>Wiâ€‘Fi è¨­å®š</label>
      <input id="fld_wifi_ssid" type="text" placeholder="SSID (ä¾‹: MyWiFi)">
      <div class="row" style="margin-top:8px">
        <input id="fld_wifi_type" type="text" placeholder="æš—å·åŒ– (WPA/WEP/none)" value="WPA">
        <input id="fld_wifi_pass" type="text" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      </div>
      <div class="small" style="margin-top:6px">å‡ºåŠ›: <code>WIFI:T:WPA;S:SSID;P:password;;</code></div>
    </div>`,
  email: () => `
    <div class="section">
      <label>ãƒ¡ãƒ¼ãƒ«</label>
      <input id="fld_mail_to" type="text" placeholder="å®›å…ˆ (to@example.com)">
      <input id="fld_mail_subject" type="text" placeholder="ä»¶å">
      <textarea id="fld_mail_body" placeholder="æœ¬æ–‡"></textarea>
    </div>`,
  sms: () => `
    <div class="section">
      <label>SMS</label>
      <input id="fld_sms_to" type="text" placeholder="é›»è©±ç•ªå·">
      <textarea id="fld_sms_body" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea>
    </div>`,
  vcard: () => `
    <div class="section">
      <label>vCard</label>
      <input id="fld_v_name" type="text" placeholder="æ°å">
      <input id="fld_v_tel" type="text" placeholder="é›»è©±">
      <input id="fld_v_email" type="text" placeholder="ãƒ¡ãƒ¼ãƒ«">
      <input id="fld_v_org" type="text" placeholder="ä¼šç¤¾ / çµ„ç¹”">
      <textarea id="fld_v_addr" placeholder="ä½æ‰€"></textarea>
    </div>`
};

function renderTemplateFields() {
  templateFields.innerHTML = templates[template.value]();
  // attach input listeners for live update
  const inners = templateFields.querySelectorAll('input, textarea');
  inners.forEach(i=>i.addEventListener('input', () => { if (autoUpdate) updateQR(); }));
}

// initial render
renderTemplateFields();
template.addEventListener('change', renderTemplateFields);

// QR code styling instance
let qr = null;
let currentLogoDataUrl = null;
let scale = 1;
let autoUpdate = true;

function buildValueFromTemplate() {
  const t = template.value;
  if (t === 'url') { const v = (document.getElementById('fld_url')||{}).value||''; return v; }
  if (t === 'text') { return (document.getElementById('fld_text')||{}).value||''; }
  if (t === 'wifi') {
    const s = (document.getElementById('fld_wifi_ssid')||{}).value||'';
    const type = (document.getElementById('fld_wifi_type')||{}).value||'WPA';
    const p = (document.getElementById('fld_wifi_pass')||{}).value||'';
    return `WIFI:T:${type};S:${escapeSemi(s)};P:${escapeSemi(p)};H:false;`;
  }
  if (t === 'email') {
    const to = (document.getElementById('fld_mail_to')||{}).value||'';
    const subj = (document.getElementById('fld_mail_subject')||{}).value||'';
    const body = (document.getElementById('fld_mail_body')||{}).value||'';
    return `MATMSG:TO:${to};SUB:${subj};BODY:${body};;`;
  }
  if (t === 'sms') {
    const to = (document.getElementById('fld_sms_to')||{}).value||'';
    const body = (document.getElementById('fld_sms_body')||{}).value||'';
    return `SMSTO:${to}:${body}`;
  }
  if (t === 'vcard') {
    const name = (document.getElementById('fld_v_name')||{}).value||'';
    const tel = (document.getElementById('fld_v_tel')||{}).value||'';
    const emailVal = (document.getElementById('fld_v_email')||{}).value||'';
    const org = (document.getElementById('fld_v_org')||{}).value||'';
    const addr = (document.getElementById('fld_v_addr')||{}).value||'';
    return [
      'BEGIN:VCARD',
      'VERSION:3.0',
      `FN:${name}`,
      org?`ORG:${org}`:'',
      tel?`TEL;TYPE=CELL:${tel}`:'',
      emailVal?`EMAIL:${emailVal}`:'',
      addr?`ADR:${addr}`:'',
      'END:VCARD'
    ].filter(Boolean).join('\n');
  }
  return '';
}

function escapeSemi(s){ return (s||'').replace(/;/g,'\\;'); }

function createQrInstance(opts) {
  if (qr) try{ qr.clear(); }catch(e){}
  qrRoot.innerHTML = '';
  qr = new QRCodeStyling(Object.assign({
    width: opts.size,
    height: opts.size,
    data: opts.data,
    image: opts.image || undefined,
    margin: Math.max(0, opts.margin||0),
    dotsOptions: opts.dotsOptions,
    cornersSquareOptions: opts.cornersSquareOptions,
    cornersDotOptions: opts.cornersDotOptions,
    backgroundOptions: opts.backgroundOptions,
    imageOptions: opts.imageOptions || {crossOrigin:"anonymous",margin:0}
  }, {}));

  // append to root
  qr.append(qrRoot);
}

function getOptionsFromForm() {
  const size = Number(sizeInput.value) || 360;
  sizeLabel.textContent = size + 'px';
  const margin = Number(marginInput.value) || 0;
  const data = buildValueFromTemplate();
  const transparent = bgTransparent.value === 'true';
  const bgColor = transparent ? 'transparent' : (bg.value || '#ffffff');
  const dots = dotStyle.value;
  const corner = cornerStyle.value;
  const dotsOptions = (()=>{
    if (dots === 'rounded') return {type:'rounded',color: fg.value};
    if (dots === 'dots') return {type:'dots',color: fg.value};
    return {type:'square',color: fg.value};
  })();
  const cornersSquareOptions = corner === 'rounded' ? {type:'rounded',color: fg.value} : {type:'square',color: fg.value};
  const cornersDotOptions = corner === 'rounded' ? {type:'dot',color: fg.value} : {type:'dot',color: fg.value};

  const backgroundOptions = {color: bgColor};
  const imageOptions = {crossOrigin:'anonymous',margin:0};

  return {
    size, margin, data,
    dotsOptions, cornersSquareOptions, cornersDotOptions, backgroundOptions, imageOptions,
    ecLevel: ecLevel.value
  };
}

async function updateQR(keepLogo) {
  const opts = getOptionsFromForm();
  // info
  const mode = detectMode(opts.data);
  info.textContent = `ãƒ¢ãƒ¼ãƒ‰: ${mode} | æ–‡å­—æ•°: ${opts.data.length}`;

  // prepare options for QRCodeStyling
  const qropts = {
    size: opts.size,
    data: opts.data,
    margin: opts.margin,
    dotsOptions: opts.dotsOptions,
    cornersSquareOptions: opts.cornersSquareOptions,
    cornersDotOptions: opts.cornersDotOptions,
    backgroundOptions: opts.backgroundOptions,
    imageOptions: opts.imageOptions
  };

  // attach logo if exists
  if (currentLogoDataUrl && keepLogo !== false) qropts.image = currentLogoDataUrl;

  createQrInstance(qropts);
}

function detectMode(text){
  if(!text) return '-';
  if(/^https?:\/\//i.test(text)) return 'URL';
  if(/^WIFI:/i.test(text)) return 'Wiâ€‘Fi';
  if(/^MATMSG:/i.test(text)) return 'Email';
  if(/^SMSTO:/i.test(text)) return 'SMS';
  if(/BEGIN:VCARD/i.test(text)) return 'vCard';
  if(/^[0-9]+$/.test(text)) return 'æ•°å­—ã®ã¿';
  return 'ãƒ†ã‚­ã‚¹ãƒˆ';
}

// logo handling
logoFile.addEventListener('change', async (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) { currentLogoDataUrl = null; logoPreview.style.display='none'; updateQR(false); return; }
  const reader = new FileReader();
  reader.onload = (ev)=>{
    currentLogoDataUrl = ev.target.result;
    logoPreview.src = currentLogoDataUrl; logoPreview.style.display = 'block';
    // set higher error correction suggestion
    ecLevel.value = 'H';
    if (autoUpdate) updateQR();
  };
  reader.readAsDataURL(f);
});

// downloads
downloadPng.addEventListener('click', async ()=>{
  if(!qr) await updateQR();
  // qr.getRawData is async; use getDataURL instead
  const blob = await qr.getRawData('png');
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `qr-${Date.now()}.png`; a.click(); URL.revokeObjectURL(url);
});

downloadSvg.addEventListener('click', async ()=>{
  if(!qr) await updateQR();
  const svg = await qr.getRawData('svg');
  const blob = new Blob([svg], {type:'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `qr-${Date.now()}.svg`; a.click(); URL.revokeObjectURL(url);
});

copyDataUrl.addEventListener('click', async ()=>{
  try{
    if(!qr) await updateQR();
    const dataUrl = await qr.getRawData('png').then(b=>{ return new Promise((res)=>{ const r = new FileReader(); r.onload = ()=>res(r.result); r.readAsDataURL(b); }); });
    await navigator.clipboard.writeText(dataUrl);
    copyDataUrl.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'; setTimeout(()=>copyDataUrl.textContent='ãƒ‡ãƒ¼ã‚¿URLã‚’ã‚³ãƒ”ãƒ¼',1400);
  }catch(e){ copyDataUrl.textContent='ã‚³ãƒ”ãƒ¼å¤±æ•—'; setTimeout(()=>copyDataUrl.textContent='ãƒ‡ãƒ¼ã‚¿URLã‚’ã‚³ãƒ”ãƒ¼',1400); }
});

// update button
updateBtn.addEventListener('click', ()=> updateQR());

// reset
resetBtn.addEventListener('click', ()=>{
  // reset fields to default
  fg.value = '#000000'; bg.value = '#ffffff'; sizeInput.value = 360; marginInput.value = 10; ecLevel.value='M'; dotStyle.value='square'; cornerStyle.value='square'; bgTransparent.value='false'; currentLogoDataUrl=null; logoPreview.style.display='none'; renderTemplateFields(); updateQR(false);
});

// zoom
zoomIn.addEventListener('click', ()=>{ scale = Math.min(2, scale + 0.2); qrRoot.style.transform = `scale(${scale})`; });
zoomOut.addEventListener('click', ()=>{ scale = Math.max(0.4, scale - 0.2); qrRoot.style.transform = `scale(${scale})`; });

// auto update on some inputs
[fg,bg,sizeInput,marginInput,ecLevel,dotStyle,cornerStyle,bgTransparent].forEach(el=>el.addEventListener('input', ()=>{ if(autoUpdate) updateQR(); }));

// initial render and update
updateQR();

// keyboard shortcuts (optional)
document.addEventListener('keydown', (e)=>{
  if(e.ctrlKey && e.key.toLowerCase()==='s'){ e.preventDefault(); downloadPng.click(); }
});

// polyfill for QRCodeStyling getRawData (some builds expose toDataURL/getDataURL)
// Note: QRCodeStyling v1.5 provides getRawData which returns blob/string or data

  </script>
</body>
</html>
